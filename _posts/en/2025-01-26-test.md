---
layout: post  
title: Test Test
lang: en
ref: 2025-01-26-test
date: 2025-01-26 12:00:00
author: Piotr
excerpt: "A comprehensive test article demonstrating the blog card system with filtering and sorting capabilities."
filter_hash_list:
  - "Testing"
  - "Documentation"
  - "Workflow"
category: "Documentation"
image: /images/posts/images-posts/2026-01-03-DigitalDelivery-CDE (1).jpg
popularity: 5
---

<!--excerpt-->

ENG

It was an intensive year full of several architectural projects, including two castles in Poland and two large offices in London, along with some smaller things. On my programming front, I’ve started coding another five plugins, two of which are already on the Autodesk App Store - Extra and Viewer. Additionally, I had to upgrade all my previous plugins from .NET Framework 4.8 to .NET Core 8, and I had plenty of fun learning more about the Revit API. On top of that, I took part in one architectural competition, I did some cool aerial photos for new developments in Cracow and got involved in various other projects. It was a busy year!

But in December, I always reserve some time for the BIMsmith Winter Wonderland challenge. Each year, I try to push myself and expand my understanding of what is possible in Revit. While writing my plugins, I spent a lot of time testing my solutions on Revit sample project (BTW Paul Aubin, big thanks for making it!). So I decided to add some “snow” to Snowdon Towers. And it made me wonder if I’m able to create my own “particle system” allowing to simulate “the first snow” falling on it.

To achieve that, I made a "snowflake" family. It is a relatively simple family, and it includes basic parametric formulas to control its shape. But on top of that, it has a mathematical formula that allows it to swing in the wind as it falls. I did it this way so later while animating I was able to control its fall with just a single parameter, element’s altitude (KISS rule). Also, to make the whole thing possible, I had to use a clever trick to enable parametric length with both positive and negative values – yeap, you can do it in Revit.

As some of you may know, I had previously created a cool & fully parametric snowflake for the BIMsmith Winter Wonderland challenge, but replicating it and/or making it better was not the aim this time. Instead, I was trying to make something small and extremely well optimized so editing thousands of them wouldn't be an issue. Performance was rather important to me, as I had to export almost 2,500 frames to create this short animation.

I hope you will like it, and Happy New Year!

//The way the family is built allows swapping my snowflake for something else - feel free to test it and use frogs instead.

Below some images showing how everything works:  

<div style="padding-bottom:56.25%; position:relative; display:block; width: 100%">
  <iframe width="100%" height="100%"
    src="https://drive.google.com/file/d/115DX4RA_8W0TaZhMN4XY3b-sVaa5a54m/preview"
    frameborder="0" allowfullscreen="" style="position:absolute; top:0; left: 0">
  </iframe>
</div>
  
![Internal Flake Family](/images/2024_BlogPost/BimSmithWWL_ParametricFlake_1.png)  
  
![Movement family](/images/2024_BlogPost/BimSmithWWL_ParametricFlake_2.png)  
  
<div style="padding-bottom:56.25%; position:relative; display:block; width: 100%">
  <iframe width="100%" height="100%"
    src="https://drive.google.com/file/d/110Pr42SR6HTxoxysvCULbkoFwZ0VWGvl/preview"
    frameborder="0" allowfullscreen="" style="position:absolute; top:0; left: 0">
  </iframe>
</div>

The code in C#:  

```c#
using Autodesk.Revit.DB;
using Autodesk.Revit.UI;
using System.Collections.Generic;
using System.Linq;

namespace W7k.Drafter
{
    [Autodesk.Revit.Attributes.Transaction(Autodesk.Revit.Attributes.TransactionMode.Manual)]
    internal class TestAnimation : IExternalCommand
    {
        public Result Execute(ExternalCommandData commandData, ref string message, ElementSet elementSet)
        {
            // SETUP
            Autodesk.Revit.ApplicationServices.Application app = commandData.Application.Application;
            Autodesk.Revit.DB.Document doc = commandData.Application.ActiveUIDocument.Document;
            UIDocument uidoc = new UIDocument(doc);

            //SELECTION
            var collectorByBuiltInCategory = new W7k.RevitAPI.CollectorByBuiltInCategory(doc, BuiltInCategory.OST_Site);
            List<Element> elements = (from s in collectorByBuiltInCategory.GetElements() 
                                      where s is FamilyInstance fI && fI.Symbol.FamilyName == "SnowFlake" 
                                      select s).ToList();
            TaskDialog.Show("Count", elements.Count.ToString());


            double step = 0.05;
            /* Code to update the animation after crash
            using Transaction t2 = new Transaction(doc, $"Previous animation");
            {
                t2.Start();
                foreach (Element el in elements)
                {
                    Parameter param = el.GetParameters("Altitude").First();
                    param.Set(param.AsDouble() - step * 1013);
                }
                t2.Commit();
            }
            */

            //for (int i = 1013; i < 3000; i++)

            for (int i = 0; i < 3000; i++)
            {
                using Transaction t1 = new Transaction(doc, $"Animate {i}");
                {
                    t1.Start();
                    foreach (Element el in elements)
                    {
                        Parameter param = el.GetParameters("Altitude").First();
                        param.Set(param.AsDouble() - step);
                    }
                    t1.Commit();
                }

                uidoc.RefreshActiveView();

                ImageExportOptions options = new ImageExportOptions
                {
                    FilePath = @"D:\test\" + i + ".png",
                    ZoomType = ZoomFitType.Zoom,
                    HLRandWFViewsFileType = ImageFileType.PNG,
                    ImageResolution = ImageResolution.DPI_300,
                    ShouldCreateWebSite = false
                };
                options.ExportRange = ExportRange.CurrentView;
                doc.ExportImage(options);
            }
            return Result.Succeeded;
        }
    }
}

```

## Additional Technical Details

### Understanding the Parametric System

The parametric system I developed for this snowflake family is based on several key principles that make it both flexible and performant. The core idea was to create a single-parameter control system that would allow for easy animation while maintaining visual interest through mathematical variation.

#### Mathematical Foundation

The swing motion of the snowflakes follows a sinusoidal pattern, which creates a natural-looking oscillation as they descend. The formula combines altitude with a phase offset to ensure each snowflake moves independently:

```
X_offset = Amplitude × sin(Altitude / WaveLength + PhaseOffset)
```

This approach ensures that even with thousands of snowflakes in the scene, each one follows its own unique path while being controlled by the same altitude parameter. The beauty of this system lies in its simplicity – change one value, and everything updates automatically.

### Performance Optimization Strategies

Working with 2,500 frames meant that every millisecond counted. Here are the key optimization strategies I employed:

1. **Minimal Geometry**: The snowflake family uses the absolute minimum number of geometric elements required to be recognizable as a snowflake
2. **Shared Parameters**: All snowflakes reference the same family type parameters, reducing memory overhead
3. **Efficient Export Pipeline**: The C# code batch-processes updates to minimize transaction overhead
4. **View Optimization**: Strategic use of view settings to balance quality and render time

### Lessons Learned

This project taught me several valuable lessons about working at scale in Revit:

**Challenge 1: Parameter Handling**  
Initially, I tried using multiple parameters to control the snowflake movement. This quickly became unwieldy with thousands of instances. The solution was to consolidate everything into altitude-driven formulas.

**Challenge 2: Export Performance**  
Early tests showed that exporting 2,500 images would take days. By optimizing the refresh cycle and export settings, I reduced this to manageable hours.

**Challenge 3: Family Structure**  
The positive/negative length trick mentioned earlier required creative use of nested families and conditional formulas. This was perhaps the most technically challenging aspect of the entire project.

## Future Applications

While this project focused on snowflakes, the underlying system has broader applications:

- **Rain Simulation**: Adjust parameters for faster fall and different patterns
- **Confetti Effects**: Use for architectural visualizations of celebration spaces
- **Falling Leaves**: Seasonal renderings for landscape architecture
- **Abstract Particles**: Creative presentations and competitions

The modular nature of the family means you can swap the snowflake geometry for anything else while keeping the motion system intact. As I mentioned, feel free to use frogs instead!

## Technical Specifications

- **Total Snowflakes**: ~500 unique instances
- **Animation Frames**: 2,497 individual renders
- **Frame Rate**: 24 fps (target)
- **Final Duration**: ~104 seconds
- **Render Resolution**: 1920x1080
- **Export Format**: PNG sequence → compiled to MP4

## Community Response

The BIMsmith Winter Wonderland challenge continues to be an incredible opportunity for the BIM community to showcase creativity and technical prowess. Each year, participants push the boundaries of what's possible in Revit, and it's inspiring to see the diverse approaches people take.

I'm grateful for the feedback I received on this year's submission and look forward to seeing what others create in future competitions.

## Conclusion

This project exemplifies the intersection of artistic vision and technical execution. By understanding the underlying mathematics and optimization principles, we can create complex, dynamic systems within the constraints of BIM software.

The key takeaway? Don't be afraid to experiment with parametric families. The time invested in setting up a robust system pays dividends when you need to iterate or scale up your work.

Thank you for reading, and I hope this inspires your own parametric adventures in Revit!

---

*For questions about the implementation details or to download sample families, feel free to reach out through the contact page.*