<!DOCTYPE html>
<html lang="{{ page.lang | default: site.default_lang }}">
<head>
    <title>
        {% if page.title %}{{ page.title }}{% if site.name %} | {% endif %}{% endif %}
        {{ site.name }}
        {% if site.description %} | {{ site.description }}{% endif %}
    </title>

    {% include meta.html %}

    <!--[if lt IE 9]>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" 
                integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYlE0=" 
                crossorigin="anonymous"></script>
    <![endif]-->

    <script>
        (function() {
            try {
                var root = document.documentElement;
                var storedTheme = null;
                
                // Try SafeStorage first if available, fallback to direct localStorage
                try {
                    if (window.SafeStorage) {
                        storedTheme = window.SafeStorage.getItem('theme');
                    } else {
                        storedTheme = localStorage.getItem('theme');
                    }
                } catch (e) {
                    // localStorage unavailable
                }
                
                var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                var theme = storedTheme || (prefersDark ? 'dark' : 'light');
                root.classList.add(theme + '-theme');
            } catch (e) {
                document.documentElement.classList.add('light-theme');
            }
        })();
    </script>
    <link rel="stylesheet" type="text/css" href="{{ site.baseurl }}/style.css" />
    <link rel="alternate" type="application/rss+xml" title="{{ site.name }} - {{ site.description }}" href="{{ site.baseurl }}/feed.xml" />
    <link rel="icon" href="{{ site.baseurl }}/images/logos/Logo_Fire_Favicon_Alpha_32x32.png" type="image/png">
    <link rel="shortcut icon" href="{{ site.baseurl }}/images/logos/Logo_Fire_Favicon_Alpha_32x32.png" type="image/png">
    {% if page.ref %}
        {% assign page_translations = site.pages | where: "ref", page.ref %}
        {% assign post_translations = site.posts | where: "ref", page.ref %}
        {% assign translations = page_translations | concat: post_translations %}
        {% for translation in translations %}
            <link rel="alternate" hreflang="{{ translation.lang | default: site.default_lang }}" href="{{ translation.url | absolute_url }}">
        {% endfor %}
    {% endif %}
    
    <!-- JavaScript -->
    <script src="{{ site.baseurl }}/assets/storage-rate-limiter.js"></script>
    <script src="{{ site.baseurl }}/assets/theme-switcher.js"></script>
    <script src="{{ site.baseurl }}/assets/language-EN-PL-switcher.js" defer></script>
    <script src="{{ site.baseurl }}/assets/mobile-nav-toggle.js" defer></script>
    <script src="{{ site.baseurl }}/assets/buttons-collapsible-content.js" defer></script>
    {% if page.url contains '/blog/' or page.url contains '/expertise-collection/' %}
    <script src="{{ site.baseurl }}/assets/universal-search-bar.js" defer></script>
    {% endif %}
    <script src="{{ site.baseurl }}/assets/hero-glitch.js" defer></script>
    <script src="{{ site.baseurl }}/assets/hero-slogan.js" defer></script>
    <script src="{{ site.baseurl }}/assets/hero-circuit.js" defer></script>
    <script src="{{ site.baseurl }}/assets/feature-cards.js" defer></script>
    <script src="{{ site.baseurl }}/assets/portfolio-tiles.js" defer></script>
    <script src="{{ site.baseurl }}/assets/portfolio-tile-click.js" defer></script>
    <script src="{{ site.baseurl }}/assets/will-change-optimizer.js" defer></script>
    <script src="{{ site.baseurl }}/assets/form-validator.js" defer></script>
    <script src="{{ site.baseurl }}/assets/progression-bar.js" defer></script>
    <script src="{{ site.baseurl }}/assets/fade-overlay.js" defer></script>
    <script src="{{ site.baseurl }}/assets/animate-expertise.js" defer></script>
</head>

<body>
    <!-- Navigation Bar -->
    <div class="nav-container">
        <div class="nav-wrapper">
            <!-- Logo Navigation Bar -->
            <a href="{{ site.baseurl }}/{{ page.lang }}/home/" class="site-avatar">
                <img src="{{ site.baseurl }}/images/logos/Logo_Fire_Favicon_Alpha_1024x1024.svg" class="nav-flame logo-animated" alt="BIM Shamans Flame" />
                <!-- Inline SVG for Syncopate font support - Light theme version -->
                <svg class="nav-logo-text logo-light" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 750 70" aria-label="BIM Shamans">
                    <text x="-2" y="57" font-family="'Syncopate', sans-serif" font-size="68" font-weight="700" letter-spacing="0.05em" fill="#32D7E6" opacity="0.75">BIM Shamans</text>
                    <text x="2" y="63" font-family="'Syncopate', sans-serif" font-size="68" font-weight="700" letter-spacing="0.05em" fill="#4183C4" opacity="0.75">BIM Shamans</text>
                    <text x="3.4" y="60" font-family="'Syncopate', sans-serif" font-size="68" font-weight="700" letter-spacing="0.05em" fill="#0f2740" opacity="0.9">BIM Shamans</text>
                    <text x="0" y="60" font-family="'Syncopate', sans-serif" font-size="68" font-weight="700" letter-spacing="0.05em" fill="#1e1e28">BIM Shamans</text>
                </svg>
                <!-- Inline SVG for Syncopate font support - Dark theme version -->
                <svg class="nav-logo-text logo-dark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 750 70" aria-label="BIM Shamans">
                    <text x="-2" y="57" font-family="'Syncopate', sans-serif" font-size="68" font-weight="700" letter-spacing="0.05em" fill="#32D7E6" opacity="0.75">BIM Shamans</text>
                    <text x="2" y="63" font-family="'Syncopate', sans-serif" font-size="68" font-weight="700" letter-spacing="0.05em" fill="#4183C4" opacity="0.75">BIM Shamans</text>
                    <text x="3.4" y="60" font-family="'Syncopate', sans-serif" font-size="68" font-weight="700" letter-spacing="0.05em" fill="#1e1e28" opacity="0.9">BIM Shamans</text>
                    <text x="0" y="60" font-family="'Syncopate', sans-serif" font-size="68" font-weight="700" letter-spacing="0.05em" fill="#e3e3ea">BIM Shamans</text>
                </svg>
            </a>

            <!-- Mobile Hamburger Menu Button -->
            <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation menu" aria-expanded="false">
                <span></span>
                <span></span>
                <span></span>
            </button>

            <!-- Navigation Menu -->
            <nav class="site-nav">
                {% assign t = site.t[page.lang] | default: site.t[site.default_lang] %}
                <a href="{{ site.baseurl }}/{{ page.lang }}/home/" class="{% if page.url contains '/home' %}active{% endif %}">{{ t.home }}</a>
                <a href="{{ site.baseurl }}/{{ page.lang }}/blog/" class="{% if page.url contains '/blog' %}active{% endif %}">{{ t.blog }}</a>
                
                <!-- Portfolio with dropdown menu (desktop only) -->
                <div class="dropdown-wrapper">
                    <a href="{{ site.baseurl }}/{{ page.lang }}/expertise/" class="{% if page.url contains '/expertise' %}active{% endif %}">{{ t.portfolio }}</a>
                    <div class="dropdown-menu">
                        <a href="{{ site.baseurl }}/{{ page.lang }}/expertise-collection/">{{ t.expertise_collection }}</a>
                    </div>
                </div>
                
                <a href="{{ site.baseurl }}/{{ page.lang }}/about/" class="{% if page.url contains '/about' or page.url contains '/project' or page.url contains '/authors' %}active{% endif %}">{{ t.about }}</a>
                
                <a href="{{ site.baseurl }}/{{ page.lang }}/contact/" class="{% if page.url contains '/contact' %}active{% endif %}">{{ t.contact }}</a>
                
                <!-- Controls inside mobile menu -->
                <div class="controls">
                    <!-- Language Switcher -->
                    <div class="language-switcher" role="group" aria-label="Language switcher">
                        <button type="button"
                                data-lang="en"
                                class="language-option {% if page.lang == 'en' %}active{% endif %}"
                                aria-pressed="{% if page.lang == 'en' %}true{% else %}false{% endif %}"
                                onclick="switchLanguage('en')">
                            EN
                        </button>
                        <span aria-hidden="true">|</span>
                        <button type="button"
                                data-lang="pl"
                                class="language-option {% if page.lang == 'pl' %}active{% endif %}"
                                aria-pressed="{% if page.lang == 'pl' %}true{% else %}false{% endif %}"
                                onclick="switchLanguage('pl')">
                            PL
                        </button>
                    </div>

                    <!-- Theme Switcher -->
                    <label class="switch">
                        <input type="checkbox" id="theme-switcher">
                        <span class="slider"></span>
                    </label>
                    <script>
                        (function() {
                            try {
                                var toggle = document.getElementById('theme-switcher');
                                if (!toggle) {
                                    return;
                                }
                                toggle.checked = document.documentElement.classList.contains('dark-theme');
                            } catch (e) {
                                // Toggle initialization fails gracefully
                            }
                        })();
                    </script>
                </div>
            </nav>

            <!-- Controls (Language and Theme Switchers) - Desktop only -->
            <div class="controls controls--desktop">
                <!-- Language Switcher -->
                <div class="language-switcher" role="group" aria-label="Language switcher">
                    <button type="button"
                            data-lang="en"
                            class="language-option {% if page.lang == 'en' %}active{% endif %}"
                            aria-pressed="{% if page.lang == 'en' %}true{% else %}false{% endif %}"
                            onclick="switchLanguage('en')">
                        EN
                    </button>
                    <span aria-hidden="true">|</span>
                    <button type="button"
                            data-lang="pl"
                            class="language-option {% if page.lang == 'pl' %}active{% endif %}"
                            aria-pressed="{% if page.lang == 'pl' %}true{% else %}false{% endif %}"
                            onclick="switchLanguage('pl')">
                        PL
                    </button>
                </div>

                <!-- Theme Switcher -->
                <label class="switch">
                    <input type="checkbox" id="theme-switcher-desktop">
                    <span class="slider"></span>
                </label>
                <script>
                    (function() {
                        try {
                            var toggle = document.getElementById('theme-switcher-desktop');
                            if (!toggle) {
                                return;
                            }
                            toggle.checked = document.documentElement.classList.contains('dark-theme');
                        } catch (e) {
                            // Toggle initialization fails gracefully
                        }
                    })();
                </script>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="main" role="main" class="container">
        {{ content }}

        {% comment %}
            <!-- Fade Overlay (for post and page layouts - needs to be turned on) -->
            {% if page.layout == 'post' or page.layout == 'page' %}
                <div class="fade-overlay"></div>
            {% endif %}
        {% endcomment %}
    </div>

    <!-- Footer -->
    <div class="wrapper-footer">
        <div class="container">
            <footer class="footer">
                {% include svg-icons.html %}
            </footer>
        </div>
    </div>

    {% include analytics.html %}
</body>
</html>