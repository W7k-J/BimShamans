<!DOCTYPE html>
<html lang="{{ page.lang | default: site.default_lang }}">
<head>
    <title>
        {% if page.title %}{{ page.title }}{% if site.name %} | {% endif %}{% endif %}
        {{ site.name }}
        {% if site.description %} | {{ site.description }}{% endif %}
    </title>

    {% include meta.html %}

    <!--[if lt IE 9]>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" 
                integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYlE0=" 
                crossorigin="anonymous"></script>
    <![endif]-->

    <script>
        (function() {
            try {
                var root = document.documentElement;
                var storedTheme = null;
                
                // Try SafeStorage first if available, fallback to direct localStorage
                try {
                    if (window.SafeStorage) {
                        storedTheme = window.SafeStorage.getItem('theme');
                    } else {
                        storedTheme = localStorage.getItem('theme');
                    }
                } catch (e) {
                    // localStorage unavailable
                }
                
                var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                var theme = storedTheme || (prefersDark ? 'dark' : 'light');
                root.classList.add(theme + '-theme');
            } catch (e) {
                document.documentElement.classList.add('light-theme');
            }
        })();
    </script>
    <link rel="stylesheet" type="text/css" href="{{ site.baseurl }}/style.css" />
    <link rel="alternate" type="application/rss+xml" title="{{ site.name }} - {{ site.description }}" href="{{ site.baseurl }}/feed.xml" />
    <link rel="icon" href="{{ site.baseurl }}/images/logos/Logo_Fire_Favicon_Alpha_32x32.png" type="image/png">
    <link rel="shortcut icon" href="{{ site.baseurl }}/images/logos/Logo_Fire_Favicon_Alpha_32x32.png" type="image/png">
    {% if page.ref %}
        {% assign page_translations = site.pages | where: "ref", page.ref %}
        {% assign post_translations = site.posts | where: "ref", page.ref %}
        {% assign translations = page_translations | concat: post_translations %}
        {% for translation in translations %}
            <link rel="alternate" hreflang="{{ translation.lang | default: site.default_lang }}" href="{{ translation.url | absolute_url }}">
        {% endfor %}
    {% endif %}
    
    <!-- JavaScript -->
    <script src="{{ site.baseurl }}/assets/storage-rate-limiter.js"></script>
    <script src="{{ site.baseurl }}/assets/theme-switcher.js"></script>
    <script src="{{ site.baseurl }}/assets/language-EN-PL-switcher.js" defer></script>
    <script src="{{ site.baseurl }}/assets/buttons-collapsible-content.js" defer></script>
    <script src="{{ site.baseurl }}/assets/hero-glitch.js" defer></script>
    <script src="{{ site.baseurl }}/assets/hero-circuit.js" defer></script>
    <script src="{{ site.baseurl }}/assets/feature-cards.js" defer></script>
    <script src="{{ site.baseurl }}/assets/will-change-optimizer.js" defer></script>
    <script src="{{ site.baseurl }}/assets/form-validator.js" defer></script>
</head>

<body>
    <!-- Navigation Bar -->
    <div class="nav-container">
        <div class="container">
            <!-- Logo Navigation Bar -->
            <a href="{{ site.baseurl }}/{{ page.lang }}/home/" class="site-avatar">
                <img src="{{ site.baseurl }}/images/logos/Logo_Fire_Favicon_Alpha_1024x1024.svg" class="logo-light logo-animated" alt="BIM Shamans Light Logo" />
                <img src="{{ site.baseurl }}/images/logos/Logo_Fire_Favicon_Alpha_1024x1024.svg" class="logo-dark logo-animated" alt="BIM Shamans Dark Logo" />
            </a>

            <!-- Navigation Menu -->
            <nav class="site-nav">
                {% assign t = site.t[page.lang] | default: site.t[site.default_lang] %}
                <a href="{{ site.baseurl }}/{{ page.lang }}/home/" class="{% if page.url contains '/home' %}active{% endif %}">{{ t.home }}</a>
                <a href="{{ site.baseurl }}/{{ page.lang }}/blog/" class="{% if page.url contains '/blog' %}active{% endif %}">{{ t.blog }}</a>
                
                <!-- About with dropdown menu -->
                <div class="dropdown-wrapper">
                    <a href="{{ site.baseurl }}/{{ page.lang }}/about/" class="{% if page.url contains '/about' or page.url contains '/project' or page.url contains '/authors' %}active{% endif %}">{{ t.about }}</a>
                    <div class="dropdown-menu">
                        {% if page.lang == 'pl' %}
                            <a href="{{ site.baseurl }}/{{ page.lang }}/project/">Projekt</a>
                            <a href="{{ site.baseurl }}/{{ page.lang }}/authors/">Autorzy</a>
                        {% else %}
                            <a href="{{ site.baseurl }}/{{ page.lang }}/project/">Project</a>
                            <a href="{{ site.baseurl }}/{{ page.lang }}/authors/">Authors</a>
                        {% endif %}
                    </div>
                </div>
                
                <a href="{{ site.baseurl }}/{{ page.lang }}/contact/" class="{% if page.url contains '/contact' %}active{% endif %}">{{ t.contact }}</a>
            </nav>

            <!-- Controls (Language and Theme Switchers) -->
            <div class="controls">
                <!-- Language Switcher -->
                <div class="language-switcher" role="group" aria-label="Language switcher">
                    <button type="button"
                            data-lang="en"
                            class="language-option {% if page.lang == 'en' %}active{% endif %}"
                            aria-pressed="{% if page.lang == 'en' %}true{% else %}false{% endif %}"
                            onclick="switchLanguage('en')">
                        EN
                    </button>
                    <span aria-hidden="true">|</span>
                    <button type="button"
                            data-lang="pl"
                            class="language-option {% if page.lang == 'pl' %}active{% endif %}"
                            aria-pressed="{% if page.lang == 'pl' %}true{% else %}false{% endif %}"
                            onclick="switchLanguage('pl')">
                        PL
                    </button>
                </div>

                <!-- Theme Switcher -->
                <label class="switch">
                    <input type="checkbox" id="theme-switcher">
                    <span class="slider"></span>
                </label>
                <script>
                    (function() {
                        try {
                            var toggle = document.getElementById('theme-switcher');
                            if (!toggle) {
                                return;
                            }
                            toggle.checked = document.documentElement.classList.contains('dark-theme');
                        } catch (e) {
                            // Toggle initialization fails gracefully
                        }
                    })();
                </script>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="main" role="main" class="container">
        {{ content }}
    </div>

    <!-- Footer -->
    <div class="wrapper-footer">
        <div class="container">
            <footer class="footer">
                {% include svg-icons.html %}
            </footer>
        </div>
    </div>

    {% include analytics.html %}
</body>
</html>